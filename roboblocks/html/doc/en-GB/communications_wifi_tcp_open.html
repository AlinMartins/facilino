<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'/>
<!--<script src='../../javascript/blockly-bq/blockly_compressed.js'></script>-->
<!--<script src='../../javascript/blockly-bq/arduino_compressed.js'></script>-->
<!--<script src='../../javascript/jquery/dist/jquery.min.js'></script>-->
<!--<script src='../../lang/en.js'></script>-->
<!--<script src='../../javascript/blockly-bq/blocks_compressed.js'></script>-->
<!--<script src='../../blocks.js'></script>-->
<style>.button_wrapper {
  text-align: center;
  color: red;
}
.button {
  background-color: #2e2efe;
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
}
 h4 { margin-top: 20px; }
 h5 { margin-top: 10px;}

</style>
<script>
function openFunction(bly) {
    $.ajax({
        type: "GET" ,
        url: bly ,
        dataType: "xml" , async: false,
        success: function(xml) {
			var txt = new XMLSerializer().serializeToString(xml);
			Blockly.mainWorkspace.clear();
			var xmlDOM = Blockly.Xml.textToDom(txt);
			Blockly.Xml.domToWorkspace(xmlDOM,Blockly.getMainWorkspace());
        }
    });
}
function injectInstruction(block,blockDiv) {
	var instructionPreview = document.getElementById(blockDiv);
	var mainWorkspace = Blockly.inject(blockDiv, {readOnly:true, collapse: false});
	mainWorkspace.clear();
	var block = mainWorkspace.newBlock(block);
	block.initSvg();
	block.render();
	block.setMovable(false);
	block.setDeletable(false);
	block.moveBy(15, 10);
	var bbox = block.getHeightWidth();
	instructionPreview.style.height = (bbox.height+50)+ 'px';
	instructionPreview.style.width = (bbox.width+50) + 'px';
	window.dispatchEvent(new Event('resize'));
}
function injectExample(example,exampleDiv) {
  var instructionPreview = document.getElementById(exampleDiv);
	var mainWorkspace = Blockly.inject(exampleDiv, {readOnly:true, collapse: false});
	openFunction('doc/examples/'+example);
	var bbox = mainWorkspace.svgBlockCanvas_.getBBox();
instructionPreview.style.height = (bbox.height+25)+ 'px';
instructionPreview.style.width = (bbox.width+25) + 'px';

	window.dispatchEvent(new Event('resize'));
}
</script>
</head>
<body>
<h3 id="up">Open Client TCP / IP connection (ESP8266)</h3>
<h4>Instruction</h4>
<div id='blocklyInstruction'></div>
<script>injectInstruction('communications_wifi_tcp_open','blocklyInstruction');</script>
<h4>Description</h4>
<p>Establishes a TCP / IP connection to a server as a TCP / IP client. Requires the IP of the server and port to communicate and select mode (integrated or non-integrated WiFi). To configure a WiFi connection, use the instruction:</p>
<div id='blocklyInstruction1'></div>
<script>injectInstruction('communications_wifi_def','blocklyInstruction1');</script>
Once the connection is opened and the data transmitted / received it is convenient to close the connection with the instruction:
<div id='blocklyInstruction2'></div>
<script>injectInstruction('communications_wifi_tcp_close','blocklyInstruction2');</script>
<h4>Dropdown lists</h4>
<ul>
  <li>Mode: Integrated or non-integrated.</li>
</ul>
<h4>Inputs</h4>
<ul>
   <li>IP Server: IP address of the server.</li>
   <li>Port: Port of connection.</li>
</ul>
<h4>Example 1</h4>
This example uses the ESP8266 WiFi module with Arduino UNO. In the example the first configuration steps are made for the connection to the network and then in the main loop a text message is sent to a server at the IP address 192.168.1.100 by the port 49152 (Arduino is the client of the connection ). If a response is received from the server, the message is displayed on the console via the USB serial port.
<div class="button_wrapper">
<p><button align="center" class="button" style="cursor: pointer;" onClick="openFunction('doc/examples/communications_wifi_def_example.bly')">Open</button></p>
All changes will be lost!
</div>
<h5>Circuit</h5>
<image src="doc/circuits/esp8266_module_example_bb.png" title="esp8266_module_example_bb" alt="esp8266_module_example_bb"></image>
<h5>Facilino Code</h5>
<div id='example1'></div>
<script>injectExample('communications_wifi_def_example.bly','example1');</script>
<h4>Example 2</h4>
This example uses the ESP8266 (integrated) processor. The example is functionally equivalent to the above example.
<div class="button_wrapper">
<p><button align="center" class="button" style="cursor: pointer;" onClick="openFunction('doc/examples/communications_wifi_def_example1.bly')">Open</button></p>
All changes will be lost!
</div>
<h5>Circuit</h5>
<image src="doc/circuits/esp8266_example_bb.png" title="esp8266_example_bb" alt="esp8266_example_bb"></image>
<h5>Facilino Code</h5>
<div id='example2'></div>
<script>injectExample('communications_wifi_def_example1.bly','example2');</script>
<p><image src="doc/common/home.png" title="home" alt="home" style="cursor: pointer;" onClick="$(function(){$('#doc').load('doc/en-GB/index.html');});"></image> | <image src="doc/common/category.png" title="category" alt="category" style="cursor: pointer;" onClick="$(function(){$('#doc').load('doc/en-GB/categories.html');});"></image> | <image src="doc/common/settings.png" title="settings" alt="settings" style="cursor: pointer;" onClick='$(function(){$("#doc").load("doc/en-GB/settings.html");});'></image> | <image src="doc/common/language.png" title="Language" alt="Language" style="cursor: pointer;" onClick="alert('Do you want to colaborate in translating Facilino to your language? Please, contact with soporte@roboticafacil.es')"></image> | <image src="doc/common/bug-fixing.png" title="bug-fixing" alt="bug-fixing" style="cursor: pointer;" onClick="alert('Have you found a bug? Please, contact with soporte@roboticafacil.es')"></image></p>
</p></body>
</html>