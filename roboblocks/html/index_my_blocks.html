<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <!-- <meta name="viewport" content="target-densitydpi=device-dpi, height=660, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />-->
  <title>Facilino MyBlocks</title>
  <script src="javascript/blockly-bq/blockly_compressed.js"></script>
  <script src="javascript/blockly-bq/arduino_compressed.js"></script>
  <script src="javascript/jquery/dist/jquery.min.js"></script>
  <script src="lang/en-gb.js"></script>
  <script src="javascript/blockly-bq/blocks_compressed.js"></script>
  <!-- <script src="closure-library/closure/goog/base.js"></script> -->
  <!-- <script src="analytics.js"></script>-->
  <script src="factory_utils.js"></script>
  <!-- <script src="workspacefactory/wfactory_model.js"></script> -->
  <!-- <script src="standard_categories.js"></script> -->
  <!-- <script src="workspacefactory/wfactory_controller.js"></script> -->
  <!-- <script src="workspacefactory/wfactory_view.js"></script> -->
  <!-- <script src="workspacefactory/wfactory_generator.js"></script> -->
  <!-- <script src="workspacefactory/wfactory_init.js"></script> -->
  <!-- <script src="block_option.js"></script> --> 
  <script src="javascript/underscore/underscore.js"></script>
  <script src="facilino_empty.js"></script>
  <script src="factory.js"></script>
  <!-- <script src="block_library_view.js"></script> -->
  <!-- <script src="block_library_storage.js"></script> -->
  <!-- <script src="block_library_controller.js"></script> -->
  <script src="block_exporter_tools.js"></script>
  <!-- <script src="block_exporter_view.js"></script> -->
  <!-- <script src="block_exporter_controller.js"></script> -->
  <script type="text/javascript" src="javascript/lib/zip.js"></script>
  <script src="blocks.js"></script>
  <script src="app_controller.js"></script>
  <!-- <script src="/storage.js"></script>-->
  <link rel="stylesheet" href="factory.css">
  <link rel="stylesheet" type="text/css" href="facilino.css">
  <link rel="stylesheet" type="text/css" href="javascript/highlight/styles/default.css">
  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  <script src="javascript/qtwebchannel/qwebchannel.js"></script>
  <script>
	if (window.webHelper === undefined ||window.webHelper===null)
	{
		window.webHelper = new Object();
		window.webHelper.sourceChanged = function(){};
	}
	document.addEventListener("DOMContentLoaded", function () {
		try{
			new QWebChannel(qt.webChannelTransport, function (channel) {
			window.webHelper = channel.objects.webHelper;
			}
			);
			}
			catch(e) {}
			
    });
    var blocklyFactory;
	zip.workerScriptsPath = 'lib/';
    var init = function() {
      //BlocklyDevTools.Analytics.init();

      blocklyFactory = new AppController();
      blocklyFactory.init();
      window.addEventListener('beforeunload', blocklyFactory.confirmLeavePage);
    };
	Facilino.load({ zoom: 1 });
    window.addEventListener('load', init);
  </script>
</head>
<body>
 
  <!-- Blockly Factory Tab -->
 <!-- <table id="blockFactoryContent" style="width:100%; height:100%">
    <tr >
      <td id="blocklyWorkspaceContainer">
        <div id="blockly" ></div>
      </td>
      <td width="50%">
        <table id="blocklyPreviewContainer">
		  <tr>
		    <td>
              Preview:
            </td>
		  </tr>
          <tr>
            <td height="25%">
			 <div id="previewDoc" style="overflow: scroll;">
			  <h4 id="docDivPre"></h4>
              <div id="preview"></div>
			  </div>
            </td>
          </tr>
          <tr>
            <td>
              Block Definition:
            </td>
          </tr>
          <tr>
            <td height="20%">
              <pre id="languagePre"></pre>
              <textarea id="languageTA"></textarea>
            </td>
          </tr>
          <tr>
            <td>
              Arduino code:
            </td>
          </tr>
          <tr>
            <td height="20%">
              <pre id="generatorPre"></pre>
            </td>
          </tr>
		  <tr>
            <td>
              Documentation <b><small>(Rendering will be correct when exporting the instruction and copy the html file into the "doc/en-GB" folder and provide appropiate files for examples)</small></b>
            </td>
          </tr>
           <tr>
            <td height="18%">
			  <iframe id="docDiv" style:"overflow: scroll;"></iframe>
            </td>
          </tr>
        </table>
      </td>
      </tr>
  </table> -->

   <div id="wrap">
        <div id="blockly" style="float: left; width: 100%;">
			<span id="position"></span>
			<div id="dragbar"></div>
		</div>	
		<div id="blocklyPreviewContainer" style="float: right; width: 33.5%;">
		  <div id="preview" style="float: none; width: 100%; height: 25%;"></div>
		  <!-- <div id="languagePre" style="float: none; width: 100%; height: 25%;"></div> -->
          <div id="languageDiv" style="float: none; width: 100%; height: 25%;">
			<pre id="languagePre" style="float: none; width: 100%; height: 25%;"></pre>
              <textarea id="languageTA"></textarea>
		  </div>
		  <!-- <div id="generatorPre" style="float: none; width: 100%; height: 25%;"></div> -->
		  <div id="generatorDiv" style="float: none; width: 100%; height: 25%;">
		    <pre id="generatorPre" style="float: none; width: 100%; height: 25%;"></pre>
		  </div>
		  <div><iframe id="docDiv" style="overflow: scroll; width: 100%; height: 25%;" frameBorder="0"></iframe></div>
		</div>
  </div>
  
  <xml id="blockfactory_toolbox" class="toolbox">
    <category name="Block">
	  <category name="Inputs">
        <block type="input_value">
        <value name="TYPE">
          <shadow type="type_null"></shadow>
        </value>
        </block>
        <block type="input_statement">
        <value name="TYPE">
          <shadow type="type_null"></shadow>
        </value>
        </block>
        <block type="input_dummy">
	    </block>
	  </category>
	  <category name="Fields">
        <block type="field_static"></block>
        <block type="field_input">
	    </block>
      <block type="field_number">
	  </block>
      <block type="field_angle">
	  </block>
      <block type="field_dropdown">
	  </block>
      <block type="field_checkbox">
	  </block>
      <block type="field_colour">
	  </block>
      <block type="field_image"></block>
	  </category>
	  <category name="Types">
      <block type="type_group"></block>
      <block type="type_null"></block>
      <block type="type_boolean"></block>
      <block type="type_number"></block>
      <block type="type_string"></block>
      <block type="type_other"></block>
	  </category>
	  <category name="Tags">
	  <block type="tag"></block>
	  </category>
	  <category name="Examples">
	  <block type="example"></block>
	  </category>
    </category>
	<category name="Code">
	  <category name="Headers">
	    <block type="code_header"></block>
	  </category>
	  <category name="Global Variables">
	    <block type="code_variable"></block>
	  </category>
	  <category name="Functions">
	    <block type="code_function"></block>
	    <block type="code_function_return"></block>
		<block type="code_function_ext"></block>
		<block type="code_function_ext_return"></block>
		<block type="code_variable"></block>
		<block type="code"></block>
	    <block type="code_join"></block>
		<block type="code_set_variables"></block>
	    <block type="code_more"></block>
	    <block type="code_func_arg"></block>
	    <block type="code_end"></block>
		<block type="code_semicolon_end"></block>
		<block type="code_if"></block>
		<block type="code_switch"></block>
		<block type="code_for"></block>
		<block type="code_while"></block>
		<block type="code_flow_statements"></block>
	  </category>
	  <category name="Setup">
	    <block type="setup_section"></block>
	    <block type="code"></block>
	    <block type="code_join"></block>
		<block type="code_set_variables"></block>
	    <block type="code_more"></block>
	    <block type="code_variables"></block>
	    <block type="code_end"></block>
		<block type="code_semicolon_end"></block>
		<block type="code_if"></block>
		<block type="code_switch"></block>
		<block type="code_for"></block>
		<block type="code_while"></block>
		<block type="code_flow_statements"></block>
	  </category>
	  <category name="Inline">
	    <block type="code"></block>
	    <block type="code_join"></block>
		<block type="code_set_variables"></block>
	    <block type="code_more"></block>
	    <block type="code_variables"></block>
	    <block type="code_end"></block>
		<block type="code_semicolon_end"></block>
		<block type="code_if"></block>
		<block type="code_switch"></block>
		<block type="code_for"></block>
		<block type="code_while"></block>
		<block type="code_flow_statements"></block>
	  </category>
	</category>
	<category name="Doc">
	  <block type="doc_input">
	    <value name="DOC">
		  <block type="text" deletable="false" movable="false">
		    <field name="TEXT"></field></block>
		</value>
	  </block>
	  <block type="doc_statement">
	    <value name="DOC">
		  <block type="text" deletable="false" movable="false">
		    <field name="TEXT"></field></block>
		</value>
	  </block>
	  <block type="doc_fields">
	    <value name="DOC">
		  <block type="text" deletable="false" movable="false">
		    <field name="TEXT"></field></block>
		</value>
	  </block>
	  <block type="doc_examples">
	    <value name="DESCRIPTION">
		  <block type="text" deletable="false" movable="false">
		    <field name="TEXT"></field></block>
		</value>
		<value name="CIRCUIT">
		  <block type="text" deletable="false" movable="false">
		    <field name="TEXT"></field><field name="EXT">.png</field></block>
		</value>
	  </block>
	</category>
  </xml> 
  <script>
		var dragging = false;
			
		$('#dragbar').mousedown(function(e){
			e.preventDefault();
       
			dragging = true;
			var code = $('#blocklyPreviewContainer');
			var ghostbar = $('<div>',
                        {id:'ghostbar',
                         css: {
                                height: code.outerHeight(),
                                top: code.offset().top,
                                left: code.offset().left
                               }
                        }).appendTo('body');
       
				$(document).mousemove(function(e){
					ghostbar.css("left",e.pageX+2);
				});
       
		});

		$(document).mouseup(function(e){
			if (dragging) 
			{
				var percentage = (e.pageX / window.innerWidth) * 100;
				var mainPercentage = 100-percentage;
				
				//console.log("side:" + percentage + " main:" + mainPercentage);
				
				width=percentage + "%";
				$('#blockly').css("width",width);
				$('.blocklySvg').width('100%');
				$('#blocklyPreviewContainer').css("width",mainPercentage + "%");
				$('#ghostbar').remove();
				$(document).unbind('mousemove');
				Blockly.svgResize(Blockly.getMainWorkspace());
				dragging = false;
			}
		});
  </script>
</body>
</html>
