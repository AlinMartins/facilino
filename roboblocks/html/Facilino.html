<html>
<head>
    	<meta charset="utf-8">
    	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
    	<meta name="robots" content="Index,Allow">
    	<meta name="description" content="Entorno de programación visual para Arduino"/>
		<link rel="shortcut icon" href="assets/images/facilino-cuadrado-fondo-transparente-128x128.png" type="image/x-icon">
    	<meta name="keywords" content="facilino,robot,arduino,dyor" />
    	<meta name="author" content="Robótica Fácil"/>
    	<title>Facilino</title>
    	
		<link rel="stylesheet" href="assets/web/assets/mobirise-icons/mobirise-icons.css">
  <link rel="stylesheet" href="assets/tether/tether.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="assets/dropdown/css/style.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">
  <link rel="stylesheet" type="text/css" href="facilino.css">
    	<link rel="stylesheet" type="text/css" href="javascript/highlight/styles/default.css">
	<style>
		select.icon-menu option {
background-repeat:no-repeat;
background-position:bottom left;
padding-left:30px;
}
	</style>
	</head>
<body>
<script src="assets/web/assets/jquery/jquery.min.js"></script>
  <script src="assets/popper/popper.min.js"></script>
  <script src="assets/tether/tether.min.js"></script>
  <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  <script src="assets/smooth-scroll/smooth-scroll.js"></script>
  <script src="assets/dropdown/js/script.min.js"></script>
  <script src="assets/touch-swipe/jquery.touch-swipe.min.js"></script>
  <script src="assets/theme/js/script.js"></script>
  
  <script src="javascript/jquery/dist/jquery.min.js"></script>
    <script src="javascript/underscore/underscore.js"></script>
    <script src="javascript/highlight/highlight.pack.js"></script>
    <script src="javascript/blockly-bq/blockly_compressed.js"></script>
    <script src="javascript/blockly-bq/blocks_compressed.js"></script>
    <script src="javascript/blockly-bq/arduino_compressed.js"></script>
    <script src="facilino_not_obfuscated.js"></script>
    <script src="roboblocks.js"></script>
	<xml id='startBlocks' style='display: none'> <block type='controls_setupLoop' deletable='true' x='20' y='5'></block> </xml>

	<div>
	<section class="menu cid-qAignIVLHL" once="menu" id="menu1-e" data-rv-view="7">
	<nav class="navbar navbar-expand beta-menu align-items-center navbar-fixed-top navbar-toggleable-sm">
		<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
        <div class="menu-logo">
            <div class="navbar-brand">
                <span class="navbar-logo">
                    <a href="https://roboticafacil.es" target="_blank">
                         <img src="assets/images/facilino-cuadrado-fondo-transparente-512x512.png" alt="Facilino" title="Facilino" media-simple="true" style="height: 3.8rem;">
                    </a>
                </span>
                <span class="navbar-caption-wrap"><a class="navbar-caption text-white display-4" href="https://roboticafacil.es" target="_blank"><h2>&nbsp;&nbsp;Facilino</h2></a></span>
            </div>
        </div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
		
            <ul class="navbar-nav nav-dropdown" data-app-modern-menu="true"><li class="nav-item dropdown open"><a class="nav-link link text-white dropdown-toggle display-4" data-toggle="dropdown-submenu" aria-expanded="true">
                        
                        File</a><div class="dropdown-menu"><button class="text-white dropdown-item display-4" onclick="resetWorkspace()" aria-expanded="false">New</button><button class="text-white dropdown-item display-4" onclick="document.getElementById('fileInput').click();" aria-expanded="false">Upload</button><input id="fileInput" type="file" style="display: none;" accept=".bly," onclick="fileSelected(this.files)"></input><button class="text-white dropdown-item display-4" onclick="butSave()" aria-expanded="false">Download</button><button class="text-white dropdown-item display-4" onclick="butExport()" aria-expanded="false">Export</button></div></li><li class="nav-item"><a class="nav-link link text-white display-4" aria-expanded="false"></a></li><li class="nav-item dropdown"><a class="nav-link link text-white dropdown-toggle display-4" aria-expanded="false" data-toggle="dropdown-submenu">
                        
                        Edit</a><div class="dropdown-menu"><button id="undo" class="text-white dropdown-item display-4" onclick="butUndo()" aria-expanded="false">Undo</button><button id="redo" class="text-white dropdown-item display-4" onclick="butRedo()" aria-expanded="false">Redo</button></div></li></ul>
            <div class="navbar-buttons mbr-section-btn"><button class="btn btn-sm btn-primary-outline display-4" title="Language settings" onclick="showHideLanguage()"><span class="mbri-flag mbr-iconfont mbr-iconfont-btn" style="color: rgb(255, 148, 0);"></span></button></div>
			<select id="language" class="text-black dropdown-toggle display-6 icon-menu" onchange="langChange(this.value)" style="display: none">
		<option value="en-GB" class="text-black dropdown-item display-6" style="background-image:url(img/flags/united-kingdom.png)">English</option>
		<option value="es-ES" class="text-black dropdown-item display-6" style="background-image:url(img/flags/spain.png)">Espa&ntilde;ol</option>
		<option value="ca-ES" class="text-black dropdown-item display-6" style="background-image:url(img/flags/catalonia.png)">Catal&agrave;</option>
		<option value="gl-ES" class="text-black dropdown-item display-6" style="background-image:url(img/flags/galician.png)">Galego</option>
		<option value="eu-ES" class="text-black dropdown-item display-6" style="background-image:url(img/flags/basque-country.png)">Euskal</option>
		<option value="de-DE" class="text-black dropdown-item display-6" style="background-image:url(img/flags/germany.png)">Deutsch</option>
		<option value="fr-FR" class="text-black dropdown-item display-6" style="background-image:url(img/flags/france.png)">Fran&ccedil;ais</option>
		<option value="it-IT" class="text-black dropdown-item display-6" style="background-image:url(img/flags/italy.png)">Italiano</option>
		<option value="pt-PT" class="text-black dropdown-item display-6" style="background-image:url(img/flags/portugal.png)">Portugues</option>
		<option value="pl-PL" class="text-black dropdown-item display-6" style="background-image:url(img/flags/poland.png)">Polski</option>
		<option value="ru-RU" class="text-black dropdown-item display-6" style="background-image:url(img/flags/russia.png)">&#x420;&#x443;&#x441;&#x441;&#x43a;&#x438;&#x439;</option>
		<option value="nb-NO" class="text-black dropdown-item display-6" style="background-image:url(img/flags/norway.png)">Norsk</option>
		</select>
		<div class="navbar-buttons mbr-section-btn"><p id="licenseP" class="btn btn-sm btn-primary-outline display-4" title="Enter your license"><span class="mbri-key mbr-iconfont mbr-iconfont-btn" style="color: rgb(255, 148, 0);"></span><input id="license_text" name="license_text" type="text" onchange="checkLicenseFcn();"/></p>  </div>
			<div class="navbar-buttons mbr-section-btn"><button id="button_copy" class="btn btn-sm btn-primary-outline display-4" title="Copy code to clipboard" onclick="copyToClipboard()"><span class="mbri-share mbr-iconfont mbr-iconfont-btn" style="color: rgb(255, 148, 0);"></span></button></div>
			
		<div class="navbar-buttons mbr-section-btn"><button class="btn btn-sm btn-primary-outline display-4" title="Create your own blocks" onclick="window.location='./FacilinoMyBlocks.html'"><span class="mbri-extension mbr-iconfont mbr-iconfont-btn" style="color: rgb(255, 148, 0);"></span></button></div>
        </div>
	</nav>
	</section>
	</div>
	<div id="wrap" style="height: 90%;">
        <div id="blockly" style="float: left; width: 66%;">
			<span id="position"></span>
			<div id="dragbar"></div>
		</div>
		<div id="code_doc" style="float: left; width: 34%;">
          <div id="code" style="float: none; width: 100%; height: 50%;">
		  </div>
		  <span id="position1"></span>
			<div id="dragbar1" style="float: none; width=100%;"></div>
		  <div id="doc" style="float: none; width: 100%; height: 50%;">
		  </div>
		</div>
    </div>
    
	
   <script language="JavaScript">
		if (localStorage.getItem("language")===undefined || localStorage.getItem("language")===null)
			localStorage.setItem('language', 'en-GB');
		if (localStorage.getItem("license")===undefined ||localStorage.getItem("license")===null)
		  localStorage.setItem('license', '');
		if (localStorage.getItem("saved")===undefined || localStorage.getItem("saved")===null)
			localStorage.setItem('saved', '');
		window.roboblocksLanguage = localStorage.getItem("language");
		var lic = localStorage.getItem("license");
		$("#language").val(window.roboblocksLanguage);
		$("#license_text").val(lic);
		checkLicense(lic);
	    window.FacilinoLanguage = window.roboblocksLanguage; 
	    //document.getElementById("doc").innerHTML = window.roboblocksLanguage;
		//document.getElementById("doc").innerHTML = license;
		var file = "doc/"+window.roboblocksLanguage+"/index.html";
		$.ajax({url:file,type:'HEAD',error: function(){file="doc/en-GB/index.html";},success: function(){}});
		$(function(){$("#doc").load(file);});
		if (localStorage.getItem("MyBlocks")===undefined || localStorage.getItem("MyBlocks")===null)
		{
			localStorage.setItem('MyBlocks', '[]');
		}
		MyBlocks = JSON.parse(localStorage.getItem('MyBlocks'));
		Blockly.Doc = [];
        RoboBlocks.load({ zoom: 1 });
		Facilino.load({ zoom: 1});
		//MyBlocks
		MyBlocks.forEach(function (block){
			eval(block.code);
			
		});
		//console.log(Blockly.Blocks['block_type1']);
		//	$.getScript( "my_blocks.js", function( data, textStatus, jqxhr ) {
			  //eval(data);
			  // New workspace for each test case
            var el = document.getElementById('blockly');
			//console.log(Blockly.createToolbox());
			
            Blockly.inject(el, {toolbox: Blockly.createToolbox()});
            // Create a default setup/loop block
			//Blockly.getMainWorkspace().clear();
            //Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'),Blockly.getMainWorkspace());
			$('.blocklySvg, #blockly').height('100%');
            $('.blocklySvg').width('100%');
			
			$("#redo").hide();
			
			if (localStorage.getItem("saved")!=='')
			  Blockly.Xml.domToWorkspace(Blockly.Xml.textToDom(localStorage.getItem("saved")),Blockly.getMainWorkspace())
			
			var History = {};
			History.stack = [];
			History.initialState ='';
			History.position=0;
			History.limit=200;
			History.updating=false;
			History.stack[0]=Blockly.Xml.domToText(Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace()));
			
	
	    var colors = [
                "",
				RoboBlocks.LANG_COLOUR_PROCEDURES,
				RoboBlocks.LANG_COLOUR_CONTROL,
				RoboBlocks.LANG_COLOUR_LOGIC,
				RoboBlocks.LANG_COLOUR_MATH,
				RoboBlocks.LANG_COLOUR_VARIABLES,
				RoboBlocks.LANG_COLOUR_TEXT,
				RoboBlocks.LANG_COLOUR_COMMUNICATION,
				RoboBlocks.LANG_COLOUR_DISTANCE,
				RoboBlocks.LANG_COLOUR_LCD,
				RoboBlocks.LANG_COLOUR_LIGHT,
				RoboBlocks.LANG_COLOUR_SOUND,
                RoboBlocks.LANG_COLOUR_MOVEMENT,
				RoboBlocks.LANG_COLOUR_AMBIENT,
				RoboBlocks.LANG_COLOUR_HTML,
				RoboBlocks.LANG_COLOUR_ADVANCED
		];
		colors.push(Blockly.createToolboxColours());
		
		
		

            /*$('.blocklyTreeRow').each( function (i,e) {
                $(e).prepend('<span class="treeLabelBlock" style="background-color:' + colors[i] + '"></span>');
            });*/
			/*$('.blocklyTreeRow').each( function (i,e) {
                $(e).prepend('<span class="treeLabelBlock"></span>');
            });*/

            // Update code
			
                Blockly.getMainWorkspace().addChangeListener(function () {
		$('#code').html('<code class="c++"><pre>'
		  + escapeCode(Blockly.Arduino.workspaceToCode(Blockly.getMainWorkspace()))
		  + '</pre></code>');
		  // Highlight
		$("pre").each(function (i, e) {
		  hljs.highlightBlock(e);
		});
			//Save History
			var current = Blockly.Xml.domToText(Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace()));
			if ((current !== History.stack[History.position])&&(current!==History.initialState))
				History.updating=true;
			//console.log(History.updating);
			if (History.updating)
			{
				while (History.stack.length > History.limit) {
					History.stack.shift();
				}
				History.position = Math.min(History.position,History.stack.length - 1);
				History.stack = History.stack.slice(0, History.position + 1);
				History.stack.push(current);
				localStorage.setItem('saved',current);
				History.position++;
				if (History.position > 0)
					$("#undo").show();
				else
					$("#undo").hide();
				if (History.position<(History.stack.length-1))
					$("#redo").show();
				else
					$("#redo").hide();
				//console.log('Saving position '+History.position);
				History.updating=false;
				//console.log(History.updating);
			}
		});
			//});
            
            // Show/hide code
            function toogleCode() {
                if ($('#code').css('display') == 'none') {
                    // Show
                    $('#code').show();
                    $('#blockly').width('66%');
					if ($('#doc').css('display') == 'none' )
					  $('#code').height('100%');
					else
					{
					  $('#code').height('50%');
					  $('#doc').width('100%');
					  $('#doc').height('50%');
					}
                } else {
                    // Hide
                    $('#code').hide();
					if ($('#doc').css('display') == 'none' )
					  $('#blockly').width('100%');
					else {
					  $('#blockly').width('66%');
					  $('#doc').width('100%');
					  $('#doc').height('100%');
					}
                }
                // Resize workspace
                Blockly.fireUiEvent(window, "resize");
            }
			
			function toogleDoc() {
                if ($('#doc').css('display') == 'none') {
                    // Show
                    $('#doc').show();
                    $('#blockly').width('66%');
					if ($('#code').css('display') == 'none' )
					  $('#doc').height('100%');
					else
					{
					  $('#doc').height('50%');
					  $('#code').width('100%');
					  $('#code').height('50%');
					}
                } else {
                    // Hide
                    $('#doc').hide();
					if ($('#code').css('display') == 'none' )
					  $('#blockly').width('100%');
					else {
					  $('#blockly').width('66%');
					  $('#code').width('100%');
					  $('#code').height('100%');
					}
                }
                // Resize workspace
                Blockly.fireUiEvent(window, "resize");
            }

            function escapeCode(code) {
                var str = code;
                str = str.replace(/</g, "&lt;");
                str = str.replace(/>/g, "&gt;");
                return str;
            }

            function resetWorkspace() {
                Blockly.mainWorkspace.clear();
                Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'),Blockly.getMainWorkspace());
            }
			
		var dragging = false;
		var dragging1 = false;
			
		$('#dragbar').mousedown(function(e){
			e.preventDefault();
       
			dragging = true;
			var code = $('#code_doc');
			var ghostbar = $('<div>',
                        {id:'ghostbar',
                         css: {
                                height: code.outerHeight(),
                                top: code.offset().top,
                                left: code.offset().left
                               }
                        }).appendTo('body');
       
				$(document).mousemove(function(e){
					ghostbar.css("left",e.pageX+2);
				});
       
		});
		
		$('#dragbar1').mousedown(function(e){
			e.preventDefault();
       
			dragging1 = true;
			var doc = $('#doc');
			var ghostbar = $('<div>',
                        {id:'ghostbar1',
                         css: {
                                width: doc.outerWidth(),
                                top: doc.offset().top,
                                left: doc.offset().left
                               }
                        }).appendTo('body');
       
				$(document).mousemove(function(e){
					ghostbar.css("top",e.pageY+2);
				});
       
		});

		$(document).mouseup(function(e){
			if (dragging) 
			{
				var percentage = (e.pageX / window.innerWidth) * 100;
				var mainPercentage = 100-percentage;
           
				//$('#console').text("side:" + percentage + " main:" + mainPercentage);
				
				$('#blockly').css("width",percentage + "%");
				$('#code_doc').css("width",mainPercentage + "%");
				$('#ghostbar').remove();
				$(document).unbind('mousemove');
				Blockly.svgResize(Blockly.getMainWorkspace());
				dragging = false;
			}
			
			if (dragging1) 
			{
				var percentage = (e.pageY / window.innerHeight) * 100;
				var mainPercentage = 100-percentage;
           
				//$('#console').text("side:" + percentage + " main:" + mainPercentage);
           
				$('#code').css("height",percentage + "%");
				$('#doc').css("height",mainPercentage + "%");
				$('#ghostbar1').remove();
				$(document).unbind('mousemove');
				dragging1 = false;
			}
		});
		
		function fileSelected(input){
			if (input.length>0)
			{
				var file = input[0];
				var reader = new FileReader();
				reader.readAsText(file);
				reader.onloadend = function(){
					var xmlData = $(reader.result);
					Blockly.mainWorkspace.clear();
					Blockly.Xml.domToWorkspace(xmlData[0],Blockly.getMainWorkspace());
				};
			}
		}
		
		function butSave()
		{
			var link = document.createElement('a');
			var text = Blockly.Xml.domToText(Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace()));
			link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(text);
			link.download = 'filename.bly';
			document.body.appendChild(link);
			link.click();
		}
		
		function butExport()
		{
			var link = document.createElement('a');
			var text = Blockly.Arduino.workspaceToCode(Blockly.getMainWorkspace());
			link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(text);
			link.download = 'filename.ino';
			document.body.appendChild(link);
			link.click();
		}
		
		function checkLicenseFcn()
		{
			var lic = $("#license_text").val();
			console.log('Checking license...');
			checkLicense(lic);
			localStorage.setItem("license",lic);
		}
		
		function butUndo()
		{
			if (History.position>0){
				var item =  History.stack[--History.position];
				if (History.position > 0)
					$("#undo").show();
				else
					$("#undo").hide();
				if (History.position<(History.stack.length-1))
					$("#redo").show();
				else
					$("#redo").hide();
				Blockly.getMainWorkspace().clear();
				Blockly.Xml.domToWorkspace(Blockly.Xml.textToDom(item),Blockly.getMainWorkspace());
				//console.log('Undo: '+History.position);
			}
		}
		
		function butRedo()
		{
			if (History.position<(History.stack.length-1))
			{
				var item = History.stack[++History.position];
				if (History.position > 0)
					$("#undo").show();
				else
					$("#undo").hide();
				if (History.position<(History.stack.length-1))
					$("#redo").show();
				else
					$("#redo").hide();
				Blockly.getMainWorkspace().clear();
				Blockly.Xml.domToWorkspace(Blockly.Xml.textToDom(item),Blockly.getMainWorkspace());
				//console.log('Redo: '+History.position);
			}
		}
		
		function langChange(lang)
		{
			localStorage.setItem('language',lang);
			window.location.reload();
		}
		
		function copyToClipboard()
		{ 
			var r = document.createRange();
			r.selectNode(document.getElementById("code"));
			window.getSelection().addRange(r);
			document.execCommand("copy");
			r.selectNode(document.body);
			window.getSelection().addRange(r);
		}
		
		function showHideLanguage()
		{
			var lang=document.getElementById('language');
			//console.log(lang.style.display);
			if (lang.style.display==='none')
				lang.style.display='initial';
			else
				lang.style.display='none';
		}
		
		function checkLicense(lic){delete window["\x6C\x69\x63\x65\x6E\x73\x65"];$("\x23\x6C\x69\x63\x65\x6E\x73\x65\x50")["\x61\x74\x74\x72"]("\x63\x6C\x61\x73\x73","\x62\x74\x6E\x20\x62\x74\x6E\x2D\x73\x6D\x20\x62\x74\x6E\x2D\x70\x72\x69\x6D\x61\x72\x79\x2D\x6F\x75\x74\x6C\x69\x6E\x65");if(lic["\x6C\x65\x6E\x67\x74\x68"]== 13){$(function(){$["\x61\x6A\x61\x78"]({url:"\x68\x74\x74\x70\x73\x3A\x2F\x2F\x72\x6F\x62\x6F\x74\x69\x63\x61\x66\x61\x63\x69\x6C\x2E\x65\x73\x2F\x66\x61\x63\x69\x6C\x69\x6E\x6F\x2F\x62\x6C\x6F\x63\x6B\x6C\x79\x2F\x6C\x6F\x67\x69\x6E\x5F\x66\x61\x63\x69\x6C\x69\x6E\x6F\x2E\x70\x68\x70\x3F\x6C\x69\x63\x65\x6E\x73\x65\x3D"+ lic,data:"",type:"\x47\x45\x54",dataType:"\x6A\x73\x6F\x6E",async:true,success:function(data,textStatus,jqXHR){if(data[1]=== "\x6F\x6B"){window["\x6C\x69\x63\x65\x6E\x73\x65"]= lic;$("\x23\x6C\x69\x63\x65\x6E\x73\x65\x50")["\x61\x74\x74\x72"]("\x63\x6C\x61\x73\x73","\x62\x74\x6E\x20\x62\x74\x6E\x2D\x73\x6D\x20\x62\x74\x6E\x2D\x70\x72\x69\x6D\x61\x72\x79")}else {if(data[1]=== "\x65\x72\x72\x6F\x72"){delete window["\x6C\x69\x63\x65\x6E\x73\x65"];$("\x23\x6C\x69\x63\x65\x6E\x73\x65\x50")["\x61\x74\x74\x72"]("\x63\x6C\x61\x73\x73","\x62\x74\x6E\x20\x62\x74\x6E\x2D\x73\x6D\x20\x62\x74\x6E\x2D\x70\x72\x69\x6D\x61\x72\x79\x2D\x6F\x75\x74\x6C\x69\x6E\x65");alert("\x57\x72\x6F\x6E\x67\x20\x6C\x69\x63\x65\x6E\x73\x65\x21")}}},error:function(jqXHR,textStatus,errorThrown){if(lic["\x6C\x65\x6E\x67\x74\x68"]!= 0){alert("\x4C\x69\x63\x65\x6E\x73\x65\x20\x63\x6F\x75\x6C\x64\x20\x6E\x6F\x74\x20\x62\x65\x20\x76\x61\x6C\x69\x64\x61\x74\x65\x64\x21\x20\x50\x6C\x65\x61\x73\x65\x20\x63\x68\x65\x63\x6B\x20\x66\x69\x72\x65\x77\x61\x6C\x6C\x20\x73\x65\x74\x74\x69\x6E\x67\x73")};delete window["\x6C\x69\x63\x65\x6E\x73\x65"];$("\x23\x6C\x69\x63\x65\x6E\x73\x65\x50")["\x61\x74\x74\x72"]("\x63\x6C\x61\x73\x73","\x62\x74\x6E\x20\x62\x74\x6E\x2D\x73\x6D\x20\x62\x74\x6E\x2D\x70\x72\x69\x6D\x61\x72\x79\x2D\x6F\x75\x74\x6C\x69\x6E\x65")}})})}}
		
		</script>
</body>
</html>